@page
@using WebTool.Controllers; 
@model WebTool.Pages.Server.Maintenance.WhiteList.IndexModel
@{
    ViewData["Title"] = "화이트 리스트";
    ViewData["ActiveMenu"] = "/Server/Maintenance/WhiteList/Index";
}

<div class="row mb-2">
    <div class="content-header">
        <h1 class="text-dark">@ViewData["Title"]</h1>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <strong>유저 번호</strong>
        <input type="text" id="user-seq" style="margin-left: 10px;" />
        <button type="button" class="btn btn-primary btn-sm" id="regist-whitelist" style="margin-left: 10px;">추가</button>
    </div>
    <div class="col-3" style="margin-top: 20px;">
        <table id="whitelist-table" class="table table-bordered table-striped table-hover dataTable dtr-inline text-center">
            <thead>
                <tr>
                    @foreach (var column in ServerController.WhiteListInfo)
                    {
                        <th>
                            @column.Name
                        </th>
                    }
                </tr>
            </thead>
        </table>
    </div>
</div>


<div id="loading" style="display: none;">
    <div class="overlay modal d-flex justify-content-center align-items-center" style="background: #00000055;">
        <i class="fas fa-2x fa-sync fa-spin"></i>
    </div>
</div>


@section Scripts {
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/js/extensions/datatables/lang.js"></script>
    <script src="~/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
    <script>
        let loading = $('#loading');
        let registButton = $('#regist-whitelist');
        let tableRoot = $('#whitelist-table');
        let userSeqValue = $('#user-seq');

        registButton.click(function () {
            let userSeq = userSeqValue.val();

            console.log(userSeq);
            startLoading();
            $.ajax({
                url: '/api/server/regist-whitelist',
                type: 'POST',
                data: {
                    UserSeq: userSeq,
                },
                success: function (res) {
                    alert('성공');
                },
                error: function (xhr, status, error) {
                    alert(xhr.responseText);
                },
                complete: function (res) {
                    endLoading();
                    location.reload();
                }
            });
        });

        $(document).ready(function () {
            tableRoot.DataTable({
                autoWidth: false,
                lengthChange: false,
                paging: false,
                searching: false,
                info: false,
                stateSave: true,
                processing: true,
                serverSide: true,
                ajax: {
                    url: '/api/server/select-whitelist',
                    type: 'POST',
                    data: {
                    }
                },
                columnDefs: [
                    {
                        targets: 0,
                        orderable: false,
                    },
                ],
                createdRow: function (row, data, dataIndex, cells) {
                }
            });
        });

        function startLoading() {
            loading.show();
        }

        function endLoading() {
            loading.hide();
        }
    </script>
}